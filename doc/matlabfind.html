<html>
<head><title>MATLABFind Documentation</title></head>
<body>
<h1>MATLABFind Documentation</h1>
<p>NEW! <a href="matlabfind-2.tgz">Download MATLABFind tarball here</a></p>
<p><a href="#install">Installation instructions</a></p>
<p><a href="mailto:jganetsk@cs.cmu.edu">Mail the author, Jason Ganetsky (jganetsk@cs.cmu.edu)</a></p>
<h2>What does MATLABFind do?</h2>
<p>This is an attempt to make MATLAB useful for discarding images in Diamond. First, the user sits down and writes MATLAB code that can judge individal images for discardability. This code is then plugged into Diamond, and is executed on a large-scale over whole Diamond image collections. Specifically, the user must write two MATLAB functions: one for initialization and the other for evaluation. Initialization is executed exactly once at the beginning of the search, before any images are processed. This enables the user a chance to setup the MATLAB workspace for use during evaluation. The evaluation function is executed once for every stored image on the Diamond server. It generates a result that is returned to the Diamond system for deciding discards. Note, the MATLAB workspace is persistent... changes made to it during init or eval persist for upcoming processing, until the search has been aborted by the user.</p>
<h2>Great. How do we use it?</h2>
<p>There are two importants requirements for the evaluation function.</p>
<ol>
<li>It must take exactly one argument. Image data is passed to the eval function via this argument. On each call, the argument will contain data corresponding to exactly one image. This image data is stored in the same form as that of return values of <code>imread</code>. All images have three 8-bit channels, R G and B.</li>
<li>The function must return one real value. This real value will be used in Diamond for deciding discards.</li>
</ol>

<p>Here's an example of a valid eval function. It is a very simple mechanism for finding the average <code>blue</code> content of an image. The return value is a score representing the blueness of the image. Higher values mean more blue, lower values mean less blue.</p>
<pre>
function ret = diamond_eval(img)
     column_avg = mean(img)
     column_avg = permute(column_avg, [2 3 1])
     color_avg = mean(column_avg)
     color_result = color_avg - mean(color_avg)
     ret = color_result(3)
</pre>

<p><b>Without Diamond, one image at a time...</b></p>
<pre>
image = imread('my_image.jpg')
result = diamond_eval(image)
if (result > 50.0)
  imshow(image)
else
  %Discard the image
end
</pre>
<p><b>With Diamond, large-scale batch processing...</b></p>
<img src="MATLABFind.png" /> <img src="MATLABFind2.png" />
<p>Configuring MATLABFind takes five steps.</p>
<ol>
<li>Enter the name of the eval function, without arguments (such as <code>diamond_eval</code>).</li>
<li>Enter the name of the init function (you are free to enter any arbitrary MATLAB command here, it doesn't really have to be a function.. I haven't actually tried leaving it blank, which would be useful).</li>
<li>Enter your threshold. The image is discarded when the eval result is below the specified threshold. In this case, the threshold is 50, meaning we only retain very blue images.</li>
<li>Find your source directory. This can be any arbitrary directory. This directory is transmitted over the wire to the Diamond server, and MATLAB is executed with it as the working directory. Note, this is not a recursive tree walk... have your MATLAB source in one flat directory with no subdirs.</li>
<li>Type a name for your search profile. Click <code>Save As</code>, switch to the <code>Investigate</code> tab, and have fun. These search profiles are vestiges held over from FatFind. Note, search profiles do not include the contents of the MATLAB source code, just the pathname to the source directory. In other words, after aborting a search, you can freely change the code in your source directory, and then you can immediately restart the search. You will not have to define a new MATLABFind search profile.</li>
</ol>

<a name="install" />
<h2>Installing MATLABFind</h2>
<ol>
<li>Install Diamond. I will assume this has been done already.</li>
<li>Install MATLAB on Diamond servers and clients. Make sure to install it to the same path on all machines.</li>
<li>Install the c-shell, also known as <code>csh</code>, on all machines. Sorry, this is a constraint of MATLAB's, not ours.</li>
<li>Install the standard dependencies. I don't know what they are, except for GLib, GTK, and Glade. If you have successfully built FatFind, then you have everything you need.</li>
<li>Untar MATLABFind. You can find it <a href="matlabfind.tgz">here</a>.</li>
<li>Edit <code>Makefile.filters</code>. You need to change the <code>MATLAB_ROOT_DIR</code> variable. Set it to the path of your MATLAB directory. Note, MATLAB dumps a giant directory tree onto your system, so you will have to find a needle in a haystack. Sorry, I don't even know where to look for a standard Linux installation, because we use MATLAB right out of our AFS space. The contents of the directory you are looking for should look something like this:
<pre>
total 163
drwxr-xr-x    2 10479    users        2048 Oct 23 15:07 activation
drwxr-xr-x    6 10479    users        2048 Oct 24 18:36 bin
drwxr-xr-x    2 10479    users        6144 Oct 23 15:07 demos
drwxr-xr-x    5 10479    users        2048 Oct 23 15:07 etc
drwxr-xr-x    6 10479    users        2048 Oct 23 15:07 extern
drwxr-xr-x    8 10479    users        4096 Oct 23 15:06 help
-rwxr-xr-x    1 10479    users       40750 Oct 23 15:07 install_matlab
-rw-r--r--    1 10479    users        9547 Oct 23 15:07 install_matlab.out
drwxr-xr-x    5 10479    users        2048 Oct 23 15:08 java
drwxr-xr-x    5 10479    users        2048 Oct 23 15:07 jhelp
-rw-r--r--    1 10479    users       74376 Oct 23 15:05 license.txt
-rw-r--r--    1 10479    users         469 Oct 23 15:05 patents.txt
drwxr-xr-x    4 10479    users        2048 Oct 23 15:05 rtw
drwxr-xr-x    5 10479    users        2048 Oct 23 15:05 simulink
drwxr-xr-x    3 10479    users        2048 Oct 23 15:05 stateflow
drwxr-xr-x   10 10479    users        2048 Oct 23 15:07 sys
drwxr-xr-x   24 10479    users        2048 Oct 23 15:15 toolbox
-rw-r--r--    1 10479    users         280 Oct 23 15:07 trademarks.txt
drwxr-xr-x    4 10479    users        2048 Oct 23 15:05 update
drwxr-xr-x    2 10479    users        2048 Oct 23 15:07 work
drwxr-xr-x    4 10479    users        2048 Oct 23 15:05 X11
</pre></li>
<li>Run <code>make -f Makefile.filters</code></li>
<li><i>If you have downloaded <code>matlabfind-2.tgz</code>, this step is unnecessary.</i> Run <code>autoconf</code> or whatever series of buildtools you usually run. This is the same process as for installing FatFind.</li>
<li>Run <code>./configure --prefix=</code>&lt;target directory for installation&gt;</li>
<li>Run <code>make</code></li>
<li>Run <code>make install</code></li>
<li>Set up your <code>~/.diamond/</code> directory as you would with FatFind.</li>
<li>Change to your target installation directory and run <code>./matlabfind</code></li>
</ol>

<p>I may have left things out. Keep in touch. <a href="mailto:jganetsk@cs.cmu.edu">jganetsk@cs.cmu.edu</a>. I promise swift and satisfying responses. I also enjoy talking on the phone. (412) 268-7555.
</body>
</html>